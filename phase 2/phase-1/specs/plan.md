# Implementation Plan: Task Organization

**Branch**: `main` | **Date**: 2026-01-02 | **Spec**: `phase-1/specs/task-organization.md`
**Input**: Feature specification from `/sp.specify` command

## Summary

Extend the Todo CLI with organizational features including priority levels (HIGH/MEDIUM/LOW), a tagging system for categorization, and deterministic CLI commands for search, filter, and sort operations. The implementation extends the existing Task entity with new fields while reusing the established repository pattern, service layer, and CLI command structure. All new commands operate on the in-memory task list with JSON file persistence.

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: argparse (stdlib), dataclasses (stdlib), enum (stdlib)
**Storage**: JSON file (`.todo/tasks.json`) - existing file_repository.py
**Testing**: pytest
**Target Platform**: CLI (Linux/macOS/Windows)
**Project Type**: Single Python CLI project
**Performance Goals**: N/A - CLI operates on in-memory data, sub-second response expected
**Constraints**: Backward compatible with existing commands, preserve existing output/error contracts
**Scale/Scope**: Single-user local storage, <1000 tasks expected

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Gate | Status | Notes |
|------|--------|-------|
| No Human Code | ✅ PASS | All implementation will be generated by Claude Code |
| AI-Generated Code | ✅ PASS | Claude Code is the sole implementation agent |
| Spec-Derived Outputs | ✅ PASS | All changes derived from task-organization.md spec |
| Agent Boundaries | ✅ PASS | Plan phase produces design artifacts only |
| Phase Isolation | ✅ PASS | Phase I only - no Phase II+ concepts introduced |
| Spec Authority | ✅ PASS | Spec is source of truth for implementation |

## Project Structure

### Documentation (this feature)

```text
phase-1/specs/
├── plan.md              # This file (/sp.plan command output)
├── task-organization.md # Feature specification (/sp.specify output)
├── task-organization-checklist.md # Quality checklist
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
└── quickstart.md        # Phase 1 output
```

### Source Code (repository root)

```text
phase-1/source/todo/
├── domain/
│   ├── entities.py      # Task entity (add priority, tags, updated_at)
│   ├── value_objects.py # Priority enum, TaskStatus update
│   ├── repository.py    # Add query methods
│   └── errors.py        # Add new error types
├── services/
│   └── task_service.py  # Add search, filter, sort methods
└── cli/
    ├── main.py          # Add search, filter, sort subparsers
    └── commands/
        ├── add.py       # Add --priority, --tag, --description
        ├── list.py      # Add --extended, priority/tags display
        ├── update.py    # Add --priority, --add-tag, --remove-tag, --description
        ├── search.py    # NEW COMMAND
        ├── filter.py    # NEW COMMAND
        └── sort.py      # NEW COMMAND
```

**Structure Decision**: Extending existing Phase 1 source structure under `phase-1/source/todo/`. No new top-level directories required. All changes are additive to existing modules.

### Tests

```text
tests/
├── unit/
│   └── domain/
│       ├── test_priority.py
│       └── test_task_extended.py
├── integration/
│   └── test_task_service_extended.py
└── cli/
    └── commands/
        ├── test_search_command.py
        ├── test_filter_command.py
        └── test_sort_command.py
```

## Complexity Tracking

> No Constitution Check violations requiring justification. All changes are within Phase I scope.

## Technical Decisions

| ID | Decision | Rationale |
|----|----------|-----------|
| TD-001 | Add Priority enum with HIGH/MEDIUM/LOW | Simple enum matches spec requirements, easy to extend |
| TD-002 | Store tags as list[str] in Task entity | Python native list, JSON serializable, supports duplicates prevention |
| TD-003 | Tag normalization: lowercase, trimmed | Consistent comparison, matches spec invariants |
| TD-004 | TaskStatus remains PENDING/COMPLETED | ACTIVE alias for PENDING in CLI for user-facing clarity |
| TD-005 | In-memory sort for search/filter/sort | Leverages existing get_all_tasks(), avoids complex repository queries |
| TD-006 | Reuse existing output format patterns | Consistent CLI experience, maintain spec contracts |

## Phase 0: Research Required

- Python dataclass default_factory patterns for mutable defaults (tags list)
- Python enum auto() vs explicit values decision
- argparse append action for multiple --tag values

## Phase 1: Design Artifacts

1. **research.md** - Technology decisions and patterns
2. **data-model.md** - Extended entity diagrams and validation rules
3. **contracts/** - CLI command contracts (synopsis, options, outputs, errors)
4. **quickstart.md** - Developer setup and testing guide

---

**Plan Generated**: 2026-01-02
**Next Phase**: `/sp.tasks` to produce ordered task list
